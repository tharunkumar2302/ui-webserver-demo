const Joi = require('joi');
const { objectId, mobileNumber } = require('./custom.validation');
const { operators } = require('../config/operators');

const createResume = {
  body: Joi.object().keys({
    firstName: Joi.string().required(),
    lastName: Joi.string().required(),
    email: Joi.string().required().email(),
    phone_no: Joi.string().required().custom(mobileNumber),
    current_location: Joi.string().required(),
    marital_status: Joi.string().allow(null, ''),
    present_address: Joi.string().allow(null, ''),
    date_of_birth: Joi.string().allow(null, ''),
    current_designation: Joi.string().allow(null, ''),
    current_company: Joi.string().allow(null, ''),
    experience: Joi.number().default(0),
    education: Joi.string().allow(null, ''),
    primary_skill: Joi.array().items(Joi.string()),
    secondary_skill: Joi.string().allow(null, ''),
    education_details: Joi.array().items(),
    experience_details: Joi.array().items(),
    current_ctc: Joi.number().default(0),
    expected_ctc: Joi.number().default(0),
    current_employment_status: Joi.string().allow(null, ''),
    industry: Joi.string().allow(null, ''),
    notice_period: Joi.string().default(0),
    prefered_location: Joi.string().allow(null, ''),
    ready_to_relocate: Joi.string().allow(null, ''),
    overseas_experience: Joi.string().allow(null, ''),
    having_passport: Joi.string().allow(null, ''),
    passport_validity: Joi.string().allow(null, ''),
    visa: Joi.string().allow(null, ''),
    file_path: Joi.string().allow(null, ''),
    About: Joi.string().allow(null, ''),
    source: Joi.string().required().valid('MANUAL-RECRUITER', 'SELF-MOBILE', 'SELF-WEB'),
    status: Joi.string().required().valid('Published', 'Draft', 'Archived'),
  }),
};
const importResumes = {
  body: Joi.object().keys({
    firstName: Joi.string().required(),
    lastName: Joi.string().required(),
    email: Joi.string().required().email(),
    phone_no: Joi.string().required().custom(mobileNumber),
    current_location: Joi.string().required(),
    marital_status: Joi.string().allow(null, ''),
    present_address: Joi.string().allow(null, ''),
    date_of_birth: Joi.string().allow(null, ''),
    current_designation: Joi.string().allow(null, ''),
    current_company: Joi.string().allow(null, ''),
    experience: Joi.number().default(0),
    education: Joi.string().allow(null, ''),
    primary_skill: Joi.array().items(Joi.string()),
    secondary_skill: Joi.string().allow(null, ''),
    education_details: Joi.array().items(),
    experience_details: Joi.array().items(),
    current_ctc: Joi.number().default(0),
    expected_ctc: Joi.number().default(0),
    current_employment_status: Joi.string().allow(null, ''),
    industry: Joi.string().allow(null, ''),
    notice_period: Joi.string().default(0),
    prefered_location: Joi.string().allow(null, ''),
    ready_to_relocate: Joi.string().allow(null, ''),
    overseas_experience: Joi.string().allow(null, ''),
    having_passport: Joi.string().allow(null, ''),
    passport_validity: Joi.string().allow(null, ''),
    visa: Joi.string().allow(null, ''),
    file_path: Joi.string().allow(null, ''),
    About: Joi.string().allow(null, ''),
    organization: Joi.string().required().custom(objectId),
    createdByUserId: Joi.string().custom(objectId),
    modifiedByUserId: Joi.string().custom(objectId),
    modifiedByUserRole: Joi.string().custom(objectId),
    createdByUserRole: Joi.string().custom(objectId),
    source: Joi.string().required().valid('EXCEL-IMPORT'),
    status: Joi.string().required().valid('Published'),
  }),
};
const getallResumes = {
  query: Joi.object().keys({
    firstName: Joi.string(),
    lastName: Joi.string(),
    email: Joi.string().email(),
    phone_no: Joi.string(),
    current_location: Joi.string(),
    marital_status: Joi.string(),
    present_address: Joi.string(),
    date_of_birth: Joi.string().allow(null, ''),
    current_designation: Joi.string(),
    current_company: Joi.string(),
    experience: Joi.number(),
    education: Joi.string(),
    primary_skill: Joi.array().items(Joi.string()),
    secondary_skill: Joi.string(),
    education_details: Joi.array().items(),
    experience_details: Joi.array().items(),
    current_ctc: Joi.number(),
    expected_ctc: Joi.number(),
    current_employment_status: Joi.string(),
    industry: Joi.string(),
    notice_period: Joi.string(),
    prefered_location: Joi.string(),
    ready_to_relocate: Joi.string(),
    overseas_experience: Joi.boolean(),
    having_passport: Joi.string(),
    passport_validity: Joi.string(),
    visa: Joi.string(),
    file_path: Joi.string(),
    About: Joi.string(),
    source: Joi.string().valid('MANUAL-RECRUITER', 'SELF-MOBILE', 'SELF-WEB'),
    status: Joi.array(),
    sortBy: Joi.string(),
    limit: Joi.number().integer().allow(null, ''),
    page: Joi.number().integer().allow(null, ''),
    keyword: Joi.string().allow(null, ''),
    cvNotUpload: Joi.boolean().default(false),
    filters: Joi.object().keys({
      location: Joi.array(),
      experience: Joi.object().keys({
        number: Joi.number().max(50),
        operator: Joi.string().valid(...operators),
      }),
      education: Joi.array(),
      skills: Joi.array(),
      ctc: Joi.object().keys({
        number: Joi.number(),
        operator: Joi.string().valid(...operators),
      }),
      employmentStatus: Joi.array(),
      noticePeriod: Joi.object().keys({
        number: Joi.number(),
        operator: Joi.string().valid(...operators),
      }),
      prefferedLocation: Joi.array(),
    }),
    export: Joi.boolean().default(false),
    columns: Joi.array().default([]),
    type: Joi.string().valid('excel', null),
  }),
};

const getResume = {
  params: Joi.object().keys({
    _id: Joi.string().custom(objectId),
  }),
};

const updateResume = {
  params: Joi.object().keys({
    _id: Joi.required().custom(objectId),
  }),
  body: Joi.object().keys({
    firstName: Joi.string(),
    lastName: Joi.string(),
    email: Joi.string().required().email(),
    phone_no: Joi.string().required(),
    current_location: Joi.string().required(),
    marital_status: Joi.string().allow(null, ''),
    present_address: Joi.string().allow(null, ''),
    date_of_birth: Joi.string().allow(null, ''),
    current_designation: Joi.string().allow(null, ''),
    current_company: Joi.string().allow(null, ''),
    experience: Joi.number().default(0),
    education: Joi.string().allow(null, ''),
    primary_skill: Joi.array().items(),
    secondary_skill: Joi.string().allow(null, ''),
    education_details: Joi.array().items(),
    experience_details: Joi.array().items(),
    current_ctc: Joi.number().default(0),
    expected_ctc: Joi.number().default(0),
    current_employment_status: Joi.string().allow(null, ''),
    industry: Joi.string().allow(null, ''),
    notice_period: Joi.string().default(0),
    prefered_location: Joi.string().allow(null, ''),
    ready_to_relocate: Joi.string().allow(null, ''),
    overseas_experience: Joi.string().allow(null, ''),
    having_passport: Joi.string().allow(null, ''),
    passport_validity: Joi.string().allow(null, ''),
    visa: Joi.string().allow(null, ''),
    created_by: Joi.string().allow(null, ''),
    file_path: Joi.string().allow(null, ''),
    uploaded_by: Joi.string().allow(null, ''),
    About: Joi.string().allow(null, ''),
    isActive: Joi.boolean().allow(null),
    status: Joi.string().valid('Published', 'Draft', 'Archived'),
  }),
};
const updateResumeForCurrentUser = {
  body: Joi.object().keys({
    firstName: Joi.string(),
    lastName: Joi.string(),
    email: Joi.string().email(),
    phone_no: Joi.string(),
    current_location: Joi.string(),
    marital_status: Joi.string().allow(null, ''),
    present_address: Joi.string().allow(null, ''),
    date_of_birth: Joi.string().allow(null, ''),
    current_designation: Joi.string().allow(null, ''),
    current_company: Joi.string().allow(null, ''),
    experience: Joi.number().default(0),
    education: Joi.string().allow(null, ''),
    primary_skill: Joi.array().items(),
    secondary_skill: Joi.string().allow(null, ''),
    education_details: Joi.array().items(),
    experience_details: Joi.array().items(),
    current_ctc: Joi.number().default(0),
    expected_ctc: Joi.number().default(0),
    current_employment_status: Joi.string().allow(null, ''),
    industry: Joi.string().allow(null, ''),
    notice_period: Joi.string().default(0),
    prefered_location: Joi.string().allow(null, ''),
    ready_to_relocate: Joi.string().allow(null, ''),
    overseas_experience: Joi.string().allow(null, ''),
    having_passport: Joi.string().allow(null, ''),
    passport_validity: Joi.string().allow(null, ''),
    visa: Joi.string().allow(null, ''),
    created_by: Joi.string().allow(null, ''),
    file_path: Joi.string().allow(null, ''),
    uploaded_by: Joi.string().allow(null, ''),
    About: Joi.string().allow(null, ''),
    status: Joi.string().valid('Published', 'Draft', 'Archived'),
  }),
};
const deleteResume = {
  params: Joi.object().keys({
    _id: Joi.string().custom(objectId),
  }),
};

const getResumesbyKeyword = {
  query: Joi.object().keys({
    keyword: Joi.string().allow(null, ''),
    sortBy: Joi.string().allow(null, ''),
    limit: Joi.number().integer(),
    page: Joi.number().integer(),
  }),
};

const exportResumes = {
  body: Joi.object().keys({
    columns: Joi.array().default([]),
    ids: Joi.array().items(objectId).default([]),
  }),
};

const getFilteredSearchData = {
  body: Joi.object().keys({
    keyword: Joi.string(),
    cvNotUpload: Joi.boolean().default(false),
    filters: Joi.object().keys({
      location: Joi.array(),
      experience: Joi.object().keys({
        number: Joi.number().max(50),
        operator: Joi.string().valid(...operators),
      }),
      education: Joi.array(),
      skills: Joi.array(),
      ctc: Joi.object().keys({
        number: Joi.number(),
        operator: Joi.string().valid(...operators),
      }),
      employmentStatus: Joi.array(),
      noticePeriod: Joi.object().keys({
        number: Joi.number(),
        operator: Joi.string().valid(...operators),
      }),
      prefferedLocation: Joi.array(),
    }),
    export: Joi.boolean().default(false),
    columns: Joi.array().default([]),
    type: Joi.string().valid('excel', null),
    sortBy: Joi.string().allow(null, ''),
    limit: Joi.number().integer(),
    page: Joi.number().integer(),
  }),
};
const downloadResume = {
  params: Joi.object().keys({
    _id: Joi.string().custom(objectId),
  }),
};
module.exports = {
  createResume,
  getallResumes,
  getResume,
  updateResume,
  deleteResume,
  getResumesbyKeyword,
  getFilteredSearchData,
  updateResumeForCurrentUser,
  importResumes,
  exportResumes,
  downloadResume,
};
